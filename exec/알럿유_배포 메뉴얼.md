# ğŸ›°ë°°í¬ ë©”ë‰´ì–¼

## ğŸ”¨ì‚¬ìš© ê¸°ìˆ  ìƒì„¸

| êµ¬ë¶„  | ê¸°ìˆ          | ìƒì„¸               | ë²„ì „                 |
| ----- | ------------ | ------------------ | -------------------- |
| ê³µí†µ  | í˜•ìƒ ê´€ë¦¬    | Gitlab             |                      |
|       | ì´ìŠˆ ê´€ë¦¬    | Jira               |                      |
|       | ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ | Notion, MatterMost |                      |
| FE    | React        | React Native       | 0.70.3               |
|       |              | React Query        | 4.13.0               |
|       |              | Recoil             | 0.7.6                |
|       | IDE          | Visual Studio Code | 1.17.2               |
|       |              | Android Studio     |                      |
| BE    | Java         | OpenJDK            | 1.8                  |
|       | Spring       | Springboot         | 2.5.                 |
|       | DB           | MySQL              | 8.0.30               |
|       |              | JPA                | 2.5.1                |
|       | IDE          | IntelliJ           | 17.0.3               |
|       | API Docs     | Swagger            | 2.9.2                |
|       | ì™¸ë¶€ API     | Naver Cloud API    |                      |
| Infra | Server       | AWS EC2            | GNU/Linux 5.4.0-1018 |
|       |              | AWS S3             | 2.2.1                |
|       |              | Firebase           |                      |
|       | CI/CD        | Docker             | 20.10.18             |
|       |              | Jenkins            | 2.361.1              |
|       | Web/SSL      | Nginx              | 1.18.0               |

<br>

## ğŸš¢Port

í”„ë¡œì íŠ¸ì˜ ê° ì£¼ìš” êµ¬ì„± ìš”ì†Œì˜ í¬íŠ¸ ë²ˆí˜¸ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

### EC2

| Port | ì´ë¦„                            |
| ---- | ------------------------------- |
| 80   | Nginx(Http => Https ë¦¬ë‹¤ì´ë ‰íŠ¸) |
| 443  | Https                           |
| 3306 | MySQL                           |
| 8085 | Springboot                      |
| 9090 | Jenkins                         |

<br>

## ğŸ—í”„ë¡œì íŠ¸ ë°°í¬ ê°œìš”

### ê°œìš”

ì› í„°ì¹˜ í•™ìƒ ë³´í˜¸ ì–´í”Œë¦¬ì¼€ì´ì…˜ 'Alert-You'ëŠ” Jenkinsë¥¼ ì´ìš©í•œ CI/CD ìë™í™” í™˜ê²½ìœ¼ë¡œ êµ¬ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.

ë°±ì—”ë“œì˜ ê²½ìš°, íŒ€ êµ¬ì„±ì›ì´ ì‘ì—…í•œ ì½”ë“œë¥¼ Gitlabì— Pushí•˜ë©´ Webhookì„ í†µí•´ Jenkins ë¹Œë“œ êµ¬ì„±ì— ë”°ë¼ CI/CD íë¦„ì´ ì§„í–‰ë©ë‹ˆë‹¤. í”„ë¡ íŠ¸ì—”ë“œì˜ ê²½ìš°, ë¹Œë“œ íŒŒì¼ì„ ìƒì„±í•˜ì—¬ ì‹¬ì‚¬ë¥¼ í†µí•´ êµ¬ê¸€ í”Œë ˆì´ìŠ¤í† ì–´ì— ë°°í¬í•˜ì˜€ìŠµë‹ˆë‹¤.

> ê° í”„ë¡œì íŠ¸ì˜ DependenciesëŠ” í”„ë¡œì íŠ¸ í´ë”ë³„ í™˜ê²½ íŒŒì¼ë“¤ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<br>

### í™˜ê²½ êµ¬ì„± ìˆœì„œ

1. MySQL ë„ì»¤ ì´ë¯¸ì§€ ì„¤ì¹˜ ë° ì»¨í…Œì´ë„ˆ ì‹¤í–‰, í™˜ê²½ ì„¤ì •
2. Jenkins ë„ì»¤ ì´ë¯¸ì§€ ì„¤ì¹˜ ë° ì»¨í…Œì´ë„ˆ ì‹¤í–‰, ë¹Œë“œ í™˜ê²½ êµ¬ì„±
3. Backend ì„œë²„(Springboot) ë„ì»¤ ì´ë¯¸ì§€ ìƒì„± ë° ì»¨í…Œì´ë„ˆ ì‹¤í–‰
4. Nginx ì„¤ì¹˜ ë° SSL ì ìš©
5. S3 ì ìš©

<br>

> ê° ë‹¨ê³„ë³„ë¡œ ì„œìˆ í•˜ì˜€ìœ¼ë©°, ìì„¸í•œ ê³¼ì •ì„ ë³´ê³  ì‹¶ìœ¼ë©´ ìì„¸íˆ ë³´ê¸°ë¥¼ í†µí•´ í™˜ê²½ êµ¬ì„± ê³¼ì •ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 1. MySQL

[ìì„¸íˆ ë³´ê¸°]

<br>

### 2. Jenkins

[ìì„¸íˆ ë³´ê¸°]

#### ë¹Œë“œ ë‹¨ê³„

> Execute Shell

```jenkins
docker image prune -a --force
mkdir -p /var/jenkins_home/images_tar

cd /var/jenkins_home/workspace/deployment/backend
docker build -t springbackend .
docker save springbackend > /var/jenkins_home/images_tar/springbackend.tar

ls /var/jenkins_home/images_tar
```

<br>

#### ë¹Œë“œ í›„ ì¡°ì¹˜

```jenkins
sudo docker load < /jenkins/images_tar/springbackend.tar

if (sudo docker ps | grep "springbackend"); then sudo docker stop springbackend; fi

sudo docker run -it -d --rm -p 8085:8085 --name springbackend springbackend
echo "Run backend"
```

<br>

### 3. Backend

[ìì„¸íˆ ë³´ê¸°]

#### Dockerfile

```dockerfile
FROM openjdk:8-jdk-alpine AS build

COPY gradlew .

COPY gradle gradle

COPY build.gradle .

COPY settings.gradle .

COPY src src

RUN chmod +x gradlew

RUN ["./gradlew", "bootJar"]

FROM openjdk:8-jdk-alpine

COPY --from=build build/libs/*.jar app.jar

EXPOSE 8085

ENTRYPOINT ["java", "-jar", "/app.jar"]
```

<br>

### 4. Nginx, SSL

[ìì„¸íˆ ë³´ê¸°]

#### nginx.conf

> /etc/nginx/nginx.conf

```nginx
user www-data;
worker_processes auto;
pid /run/nginx.pid;
include /etc/nginx/modules-enabled/*.conf;

events {
	worker_connections 768;
	# multi_accept on;
}

http {

	##
	# Basic Settings
	##

	sendfile on;
	tcp_nopush on;
	tcp_nodelay on;
	keepalive_timeout 65;
	types_hash_max_size 2048;
	# server_tokens off;

	# server_names_hash_bucket_size 64;
	# server_name_in_redirect off;

	include /etc/nginx/mime.types;
	default_type application/octet-stream;

	##
	# SSL Settings
	##

	ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # Dropping SSLv3, ref: POODLE
	ssl_prefer_server_ciphers on;

	##
	# Logging Settings
	##

	access_log /var/log/nginx/access.log;
	error_log /var/log/nginx/error.log;

	##
	# Gzip Settings
	##

	gzip on;

	# gzip_vary on;
	# gzip_proxied any;
	# gzip_comp_level 6;
	# gzip_buffers 16 8k;
	# gzip_http_version 1.1;
	# gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

	##
	# Virtual Host Configs
	##

	include /etc/nginx/conf.d/*.conf;
	include /etc/nginx/sites-enabled/*;
}


#mail {
#	# See sample authentication script at:
#	# http://wiki.nginx.org/ImapAuthenticateWithApachePhpScript
#
#	# auth_http localhost/auth.php;
#	# pop3_capabilities "TOP" "USER";
#	# imap_capabilities "IMAP4rev1" "UIDPLUS";
#
#	server {
#		listen     localhost:110;
#		protocol   pop3;
#		proxy      on;
#	}
#
#	server {
#		listen     localhost:143;
#		protocol   imap;
#		proxy      on;
#	}
#}
```

<br>

#### B109.conf

> /etc/nginx/sites-available

```nginx
server {
        location /api {
                proxy_pass http://localhost:8085/api;
        }

    listen 443 ssl; # managed by Certbot
    # ë„ë©”ì¸ ì´ë¦„ì„ ì¨ì¤˜ì•¼í•¨
    ssl_certificate /etc/letsencrypt/live/k7b109.p.ssafy.io/fullchain.pem; # managed by Certbot
    # ë„ë©”ì¸ ì´ë¦„ì„ ì¨ì¤˜ì•¼í•¨
    ssl_certificate_key /etc/letsencrypt/live/k7b109.p.ssafy.io/privkey.pem; # managed by Certbot
    # include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    # ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot
    client_max_body_size 0;
}

server {
    # ë„ë©”ì¸ ì´ë¦„ì„ ì…ë ¥
    if ($host = k7b109.p.ssafy.io) {
        return 301 https://$host$request_uri;
    } # managed by Certbot

        listen 80;
        server_name k7b109.p.ssafy.io;
    return 404; # managed by Certbot

}
```

<br>

### 5. S3

[ìì„¸íˆ ë³´ê¸°]
