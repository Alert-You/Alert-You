# 00_Deployment_Strategy(배포 전략)

무중단 배포 전략

## 1. Rolling (롤링 업데이트 배포)

신버전의 서버를 만들어가면서 트래픽을 구버전에서 신버전으로 서서히 점진적으로 옮기는 배포 방식

블루/그린 배포 방식이 인프라 리소스가 2배로 소요되는 반면, 롤링 배포 방식은 서버 자원이 한정적인 경우 유리

### 장점

- Downtime이 없음
- 버전의 업데이트와 테스팅을 동시에 수행할 수 있음

### 단점

- 구버전과 신버전이 공존하는 시기에 두 버전을 모두 고려하여 개발을 진행해야 한다.(예-DB스키마 등)
- 배포 중 한쪽의 인스턴스 수가 감소되므로 서버의 처리 용량을 미리 고려해야한다
- 서버가 롤링 업데이트 상태로 넘어갈 때 기존 서버에 접속하고 있던 사용자의 세션을 신규 서버로 이전해야하는데, 이를 고려해야한다

![image](https://user-images.githubusercontent.com/93081720/196716473-3b2102ae-86d8-49d1-b8b6-dc8e5f742db1.png)

<br>

## 2. Blue/Green (블루/그린 배포)

구버전을 블루, 신버전을 그린이라고 해서 이름이 붙여진 배포 방식

신버전의 배포를 모두 완료한 뒤에 로드밸런서를 통해 트래픽을 구버전에서 신버전으로 일제히 전환하는 방식

### 장점

- 빠른 롤백; 배포된 신버전에 문제가 있을 경우 트래픽을 다시 구버전에 옮길 수 있음
- Downtime 최소화; 구버전에서 신버전으로 일순간에 옮기기만 하면됨
- 실제 서비스 환경에서 테스트 가능

### 단점

- 인프라 리소스가 2배로 소요되므로 비용 많이 든다
- 기존 운영 중인 블루에서 Long-term 트랜잭션이 수행 중이었다면 그린으로 전환 시에 어떤 방식으로 처리할 것인지에 대한 고민이 충분히 이루어져야한다
- 두 서버 환경 간 migration이 배포 때마다 필요하며, Rollback 수행 시에도 마찬가지로 고려해야한다.

![image](https://user-images.githubusercontent.com/93081720/196718080-0f23ed23-fcea-46bd-8c20-11db2c0ec65a.png)

<br>

## 3. Canary (카나리아 배포)

옛날 광부들이 광산에서 유독 가스가 나오는 것을 확인하기 위해 가스에 민감한 카나리아 새를 이용한데에서 유래한 개발/배포 방식

일부 서버에만 일정 비율 신버전을 배포하여 운영(테스트)하면서 문제가 없음이 확인되면 그 비율을 점차 늘려가면서 모든 서버에 신버전을 배포하는 방식

![image](https://user-images.githubusercontent.com/93081720/196717421-038b6e99-c823-4739-b991-2539ce490ccf.png)

### 장점

- 위험을 빠르게 감지 가능
- 성능 모니터링에 유용, Rollback도 간단하게 가능
- 운영 중인 상태에서 실제 서비스 환경을 테스트 가능

### 단점

- 동일 시점에 여러 개의 어플리케이션 버전을 관리해야함

